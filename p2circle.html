
<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Sequences sunburst</title>
    <script src="http://d3js.org/d3.v3.min.js"></script>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css"
      href="https://fonts.googleapis.com/css?family=Open+Sans:400,600">
<link rel="stylesheet" type="text/css" href="styles.css"> 
<title>Success of Movies</title>
  </head>
  <body>
    <div id ="container">
    <h1>Success of Movies</h1>
    <h2>Cyndi Chin, Jessica Lee, Thomas Perz</h2>
    <h4>Our Story</h4>
    <p>The chart below displays the amount of </p>
  </div>
 
    <div id="main">
      <!-- <div id="sequence"></div> -->
      <div id="chart">
        <div id="explanation" style="visibility: hidden;">
          <span id="percentage"></span><br/>
          of profits for <br/>
          <span id="name"></span><br/>
        </div>
      </div>
    </div>

    <script src="underscore-min.js" type="text/javascript"></script>
<script src="underscore.string.min.js" type="text/javascript"></script>

<script>
      //*************************************************
      // SETUP DATA VIZ
      //*************************************************
      function load_data (filename) {
      var width = 960, height = 960, radius = 400;

      var color = d3.scale.ordinal().range(["#1f77b4", "#ff7f0e", "#2ca02c", "#d62728", "#9467bd", "#8c564b", "#e377c2", "#7f7f7f", "#bcbd22", "#17becf",'#ccc','#26527C','#61D7A4','#6CAC2B','#408AD2','#218359','#36D792','#679ED2','#B0F26D','#4B9500','#98F23D','#04396C','#007241']);

      var svg = d3.select("#chart").append("svg")
      .attr("width", width)
      .attr("height", height)
      .append("g")
      .attr("id","chart")
      .attr("transform", "translate(" + width / 2 + "," + height * .52 + ")");

      var partition = d3.layout.partition()
      .sort(null)
      .size([2 * Math.PI, radius * radius])
      .value(function(d) { return d.Gross; });

      var arc = d3.svg.arc()
      .startAngle(function(d) { return d.x; })
      .endAngle(function(d) { return d.x + d.dx; })
      .innerRadius(function(d) { return Math.sqrt(d.y); })
      .outerRadius(function(d) { return Math.sqrt(d.y + d.dy); });
      
      var totalSize = 0; 
      
      //*************************************************
      // GET THE CSV DATA
      //*************************************************
      d3.csv(filename, function(error, data) {

      _.each(data, function(element, index, list){
        element.Gross = +element.Gross;
      });

      //*************************************************
      // THE FUNCTION
      //*************************************************
      function genJSON(csvData, groups) {

        var genGroups = function(data) {
        return _.map(data, function(element, index) {
          return { name : index, children : element };
        });
        };

        var nest = function(node, curIndex) {
        // console.log(node.children);
        if (curIndex === 0) {
          node.children = genGroups(_.groupBy(csvData, groups[0]));
          _.each(node.children, function (child) {
          nest(child, curIndex + 1);
          });
        }
        else {
          if (curIndex < groups.length) {
          node.children = genGroups(
            _.groupBy(node.children, groups[curIndex])
          );
          _.each(node.children, function (child) {
            nest(child, curIndex + 1);
          });
          }
        }
        return node;

        };
        return nest({}, 0);
      }

      //*************************************************
      // CALL THE FUNCTION
      //*************************************************
      var preppedData = genJSON(data, ['Studio', 'Genre', 'Film'])
  // console.log(JSON.stringify(preppedData));
      //*************************************************
      // LOAD THE PREPPED DATA IN D3
      //*************************************************

      var div = d3.select("body").append("div") 
    .attr("class", "tooltip")       
    .style("opacity", 0);

      var path = svg.datum(preppedData).selectAll("path")
        .data(partition.nodes)
        .enter().append("path")
        .attr("display", function(d) { return d.depth ? null : "none"; }) // hide inner ring
        .attr("d", arc)
        .attr("class", function(d) { return (d.children ? d : d.parent).name; })
        .style("stroke", "#fff")
        .style("fill", function(d) { return color((d.children ? d : d.parent).name); })
        .style("fill-rule", "evenodd")
        .on("mouseover", mouseover);

   d3.select("#container").on("mouseleave", mouseleave);
    totalSize = path.node().__data__.value;


  function mouseover(d) {

    var percentage = (100 * d.value / totalSize).toPrecision(3);
    var percentageString = percentage + "%";
    if (percentage < 0.1) {
    percentageString = "< 0.1%";
    }

    d3.select("#percentage")
      .text(percentageString);

    d3.select("#explanation")
      .style("visibility", "");

    d3.select("#name")
      .text(d.name);

    // Fade all the segments.
    d3.selectAll("path")
      .style("opacity", 0.3);

    d3.select(this).style("opacity", "1")

    // Then highlight only those that are an ancestor of the current segment.
    // svg.selectAll("path")
    //     .filter(function(node) {
    //               return ;
    //             })
    //     .style("opacity", 1);
      

  }

  d3.select("#chart").on("mouseleave", mouseleave);
        function mouseleave(d) {

    // Deactivate all segments during transition.
    // d3.selectAll("path").on("mouseover", null);

    // Transition each segment to full opacity and then reactivate it.
    d3.selectAll("path")
      .transition()
      .duration(500)
      .style("opacity", 1);

    d3.select("#explanation")
      .style("visibility", "hidden");
  }

      //   .on("mouseover", function(d) {
      // d3.select(this).style("opacity", ".8")
    
      //     div.transition()    
      //         .duration(200)    
      //         .style("fill", "blue")
      //         .style("opacity", 1)  
     
      
      // .on("mouseout", function(d) {
      // d3.select(this).style("opacity", 1);
      //     div.transition()    
      //         .duration(500)    
      //         .style("opacity", 1); 
      // });


      });
      
      
    }
    
    function change_data (year) {
    d3.select("svg").remove();
    load_data(year + ".csv");
   $("#2011").removeClass("selected");
        $("#2010").removeClass("selected");
             $("#2009").removeClass("selected");
                  $("#2008").removeClass("selected");
                       $("#2007").removeClass("selected");

     $("#"+year).addClass("selected");
     
    console.log(year);
    }
    change_data(2011);
    
</script>
            <footer>
        <ul>
      <li><a id="2011" class="" onclick = change_data(2011) >2011</a></li>
      <li><a id="2010" class="" onclick = change_data(2010)>2010</a></li> 
      <li><a id="2009" class="" onclick = change_data(2009)>2009</a></li>
      <li><a id="2008" class="" onclick = change_data(2008)>2008</a></li> 
      <li><a id="2007" class="" onclick = change_data(2007)>2007</a></li> 
    </ul>
                
            </footer>  
  </body>
</html>
